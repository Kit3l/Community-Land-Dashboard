<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Community Dashboard</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      display: flex;
      height: 100vh;
      background-color: #f5f7fb;
      color: #333;
    }

    .sidebar {
      width: 240px;
      background: linear-gradient(135deg, #e4c52b, #060605);
      color: white;
      padding: 30px 20px;
    }

    .sidebar h2 {
      margin-bottom: 30px;
      font-size: 24px;
      font-weight: bold;
    }

    .sidebar ul {
      list-style: none;
    }

    .sidebar ul li {
      margin-bottom: 20px;
    }

    .sidebar ul li a {
      text-decoration: none;
      color: white;
      font-size: 16px;
      display: flex;
      align-items: center;
    }

    .sidebar ul li a:hover {
      opacity: 0.8;
    }

    .main {
      flex: 1;
      padding: 30px;
      overflow-y: auto;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }

    .header h1 {
      font-size: 28px;
    }

    .dashboard-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }

    .card {
      background: white;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
      transition: transform 0.2s ease;
    }

    .card:hover {
      transform: translateY(-4px);
    }

    .card h3 {
      font-size: 20px;
      margin-bottom: 10px;
      color: #555;
    }

    .card p {
      font-size: 24px;
      font-weight: bold;
      color: #2BC0E4;
    }

    .card-icon {
      font-size: 32px;
      margin-bottom: 10px;
    }

    .gradient-bg {
      background: linear-gradient(135deg, #e4d12b, #f1f1f0);
      color: white;
    }

    .gradient-bg p {
      color: white;
    }

    #map-container {
      margin-top: 30px;
      background: white;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    #leaflet-map {
      width: 100%;
      height: 600px !important;
      border-radius: 16px;
    }

    @media (max-width: 768px) {
      .sidebar {
        display: none;
      }

      .main {
        padding: 20px;
      }
    }
  </style>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <h2>Drylands Learning and Capacity Building Initiative</h2>
    <ul>
      <li><a href="dashboard.html"><span>üè†</span>&nbsp; Dashboard</a></li>
      <li><a href="communities.html"><span>üåç</span>&nbsp; Communities</a></li>
      <li><a href="#"><span>üßë</span>&nbsp; Users</a></li>
      <li><a href="#"><span>üìã</span>&nbsp; Reports</a></li>
    </ul>
  </div>

  <!-- Main Content -->
  <div class="main">
    <div class="header">
      <h1>üëã Welcome, Admin</h1>
    </div>

    <div class="dashboard-cards">
      <div class="card gradient-bg">
        <div class="card-icon">üåç</div>
        <h3>Total Counties</h3>
        <p>5</p>
      </div>

      <div class="card gradient-bg">
        <div class="card-icon">üìè</div>
        <h3>Total Land Size</h3>
        <p>227,030 KM¬≤</p>
      </div>
    </div>

    <!-- Real Map -->
    <div id="map-container">
      <h3>Interactive Counties Map</h3>
      <div id="leaflet-map"></div>
    </div>
  </div>

  <script>
    const kenyaBounds = [
      [-4.9, 33.5],  
      [5.2, 42.0]    
    ];

    const map = L.map('leaflet-map', {
      minZoom: 6,
      maxZoom: 10,
      maxBounds: kenyaBounds,
      maxBoundsViscosity: 1.0,
      zoomControl: true
    }).setView([1.2921, 36.8219], 7); 

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    fetch('https://raw.githubusercontent.com/deldersveld/topojson/master/countries/kenya/kenya-counties.json')
      .then(response => response.json())
      .then(data => {
        const geojson = L.geoJSON(data, {
          style: {
            color: "#555",
            weight: 1.2,
            fillColor: "#f1c40f",
            fillOpacity: 0.6
          },
          onEachFeature: function (feature, layer) {
            const name = feature.properties.COUNTY || feature.properties.name;
            layer.on({
              mouseover: e => e.target.setStyle({ weight: 3, color: "#000", fillOpacity: 0.9 }),
              mouseout: e => geojson.resetStyle(e.target),
              click: () => alert("You clicked on " + name)
            });

            const centroid = layer.getBounds().getCenter();
            const countyMarker = L.marker(centroid).addTo(map);
            countyMarker.bindPopup(`<b>County:</b> ${name}`);

            layer.bindTooltip(name, {
              direction: "top",
              className: "county-label"
            });
          }
        }).addTo(map);
      })
      .catch(error => console.error('Error loading GeoJSON:', error));

    const communityData = {
      "Lorengippi": { size: "26000 ha", population: 5000, registeredMembers: 3780 },
      "Turkana West": { size: "26000 ha", population: 5000, registeredMembers: 3780 },
      "Lokicha": { size: "26000 ha", population: 5000, registeredMembers: 3780 },
      "Leheley": { size: "26000 ha", population: 5000, registeredMembers: 3780 },
      "Diff": { size: "26000 ha", population: 5000, registeredMembers: 3780 },
      "Sabuli": { size: "26000 ha", population: 5000, registeredMembers: 3780 },
      "Obittu": { size: "26000 ha", population: 5000, registeredMembers: 3780 },
      "Walda": { size: "26000 ha", population: 5000, registeredMembers: 3780 },
      "Lokitonyila": { size: "26000 ha", population: 5000, registeredMembers: 3780 },
      "Kasei": { size: "26000 ha", population: 5000, registeredMembers: 3780 },
      "Alale": { size: "26000 ha", population: 5000, registeredMembers: 3780 },
      "Charri": { size: "26000 ha", population: 5000, registeredMembers: 3780 },
      "Cherab": { size: "26000 ha", population: 5000, registeredMembers: 3780 },
      "Kinna": { size: "26000 ha", population: 5000, registeredMembers: 3780 },
      "West Pokot Central": { size: "15000 ha", population: 4000, registeredMembers: 2500 },
      "West Pokot East": { size: "18000 ha", population: 4500, registeredMembers: 3000 }
    };

    const communityCoordinates = {
      "Lorengippi": [3.0, 35.5],
      "Turkana West": [3.2, 35.7],
      "Lokicha": [3.1, 35.6],
      "Leheley": [1.7, 39.5],
      "Diff": [1.8, 39.6],
      "Sabuli": [1.9, 39.7],
      "Obittu": [2.3, 37.9],
      "Walda": [2.4, 38.0],
      "Lokitonyila": [1.2, 35.0],
      "Kasei": [1.3, 35.1],
      "Alale": [1.4, 35.2],
      "Charri": [0.5, 37.6],
      "Cherab": [0.6, 37.7],
      "Kinna": [0.7, 37.8],
      "West Pokot Central": [1.2, 35.0],
      "West Pokot East": [1.3, 35.1]
    };

    const iconColors = [
      'red', 'blue', 'green', 'orange', 'purple', 'yellow', 'pink', 'cyan', 'magenta', 'lime', 'brown', 'black', 'gray', 'darkred'
    ];

    function createColoredIcon(color) {
      return new L.Icon({
        iconUrl: `https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-${color}.png`,
        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
        shadowSize: [41, 41]
      });
    }

    const markers = {};
    let colorIndex = 0;
    for (const [name, coords] of Object.entries(communityCoordinates)) {
      const color = iconColors[colorIndex % iconColors.length];
      const coloredIcon = createColoredIcon(color);
      const marker = L.marker(coords, { icon: coloredIcon }).addTo(map);
      marker.bindPopup(`
        <div style="width: 260px; background: #eef6fb; border: 1px solid #2BC0E4; border-radius: 8px; padding: 8px;">
          <h3 style="margin-top: 0;">${name}</h3>
          <table style="border-collapse: collapse; width: 100%;">
            <tr>
              <th style="text-align: left; padding: 4px; border-bottom: 1px solid #2BC0E4;">Size</th>
              <td style="padding: 4px; border-bottom: 1px solid #2BC0E4;">${communityData[name].size}</td>
            </tr>
            <tr>
              <th style="text-align: left; padding: 4px; border-bottom: 1px solid #2BC0E4;">Population</th>
              <td style="padding: 4px; border-bottom: 1px solid #2BC0E4;">${communityData[name].population}</td>
            </tr>
            <tr>
              <th style="text-align: left; padding: 4px;">Registered Members</th>
              <td style="padding: 4px;">${communityData[name].registeredMembers.toLocaleString()}</td>
            </tr>
          </table>
        </div>
      `);
      markers[name] = marker;
      colorIndex++;
    }

    function getQueryParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }

    window.addEventListener('load', () => {
      const community = getQueryParam('community');
      if (community && markers[community]) {
        map.flyTo(markers[community].getLatLng(), 10, { animate: true });
        markers[community].openPopup();
        const mapContainer = document.getElementById('map-container');
        if (mapContainer) {
          mapContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      }
    });
  </script>
</body>
</html>
