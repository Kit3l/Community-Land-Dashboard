<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Communities</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    body { display: flex; min-height: 100vh; background-color: #f5f7fb; color: #333; }
    /* Sidebar */
    .sidebar { width: 280px; background: linear-gradient(135deg, #e4d12b, #EAECC6); color: white; padding: 24px; display: flex; flex-direction: column; }
    .sidebar h2 { margin-bottom: 20px; font-size: 20px; font-weight: bold; }
    .sidebar ul { list-style: none; padding-left: 0; }
    .sidebar ul li { margin-bottom: 12px; }
    .sidebar ul li a { text-decoration: none; color: white; font-size: 15px; display: flex; align-items: center; }
    .sidebar ul li a:hover { opacity: 0.85; }
    /* Legend */
    .legend { margin-top: 18px; background: rgba(255,255,255,0.15); padding: 12px; border-radius: 10px; }
    .legend h3 { font-size: 16px; margin-bottom: 8px; }
    .legend-item { display: flex; align-items: center; margin-bottom: 6px; font-size: 14px; }
    .dot { height: 14px; width: 14px; border-radius: 50%; margin-right: 8px; border: 1px solid rgba(0,0,0,0.1); }
    .dot.green { background-color: #2e7d32; }
    .dot.orange { background-color: #ef6c00; }
    .dot.red { background-color: #c62828; }

    /* Main */
    .main { flex: 1; padding: 24px; }
    h1 { font-size: 26px; margin-bottom: 16px; }
    .county { background: white; padding: 16px; margin-bottom: 14px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.06); }
    .county h2 { color: #e4ce2b; margin-bottom: 8px; }
    .community-list { margin-left: 18px; }
    .community-list li { margin-bottom: 6px; }
    .community-list li a { color: #007acc; text-decoration: none; cursor: pointer; }
    .community-list li a:hover { text-decoration: underline; }
    /* Details panel */
    .community-details { margin-top: 12px; padding: 12px; background: #eef6fb; border-left: 5px solid #2BC0E4; border-radius: 8px; display: none; }
    .community-details.active { display: block; }
    /* Map */
    #map-container { margin-top: 18px; height: 620px; border-radius: 12px; box-shadow: 0 4px 16px rgba(0,0,0,0.08); overflow: hidden; }
    @media (max-width: 768px) { .sidebar { display: none; } .main { padding: 14px; } #map-container { height: 520px; } }
  </style>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <div>
      <h2>Drylands Learning & Capacity Building Initiative</h2>
      <ul>
        <li><a href="dashboard.html"><span>üè†</span>&nbsp; Dashboard</a></li>
        <li><a href="communities.html"><span>üåç</span>&nbsp; Communities</a></li>
        <li><a href="#"><span>üßë</span>&nbsp; Users</a></li>
        <li><a href="#"><span>üìã</span>&nbsp; Resources</a></li>
      </ul>

      <!-- Legend -->
      <div class="legend">
        <h3>Legend</h3>
        <div class="legend-item"><span class="dot green"></span> Registered</div>
        <div class="legend-item"><span class="dot orange"></span> In Process</div>
        <div class="legend-item"><span class="dot red"></span> Not Registered (Identified)</div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main">
    <h1>üåç Counties & Communities</h1>

    <!-- TURKANA -->
    <div class="county">
      <h2>Turkana</h2>
      <ul class="community-list">
        <li><a href="communities.html?community=Lorengippi">Lorengippi</a></li>
        <li><a href="communities.html?community=Turkana%20West">Turkana West</a></li>
        <li><a href="communities.html?community=Lokichar">Lokichar</a></li>
      </ul>
    </div>

    <!-- WAJIR -->
    <div class="county">
      <h2>Wajir</h2>
      <ul class="community-list">
        <li><a href="communities.html?community=Leheley">Leheley</a></li>
        <li><a href="communities.html?community=Diff">Diff</a></li>
        <li><a href="communities.html?community=Sabuli">Sabuli</a></li>
      </ul>
    </div>

    <!-- MARSABIT -->
    <div class="county">
      <h2>Marsabit</h2>
      <ul class="community-list">
        <li><a href="communities.html?community=Obbu">Obbu</a></li>
        <li><a href="communities.html?community=Obittu">Obittu</a></li>
        <li><a href="communities.html?community=Walda">Walda</a></li>
      </ul>
    </div>

    <!-- WEST POKOT -->
    <div class="county">
      <h2>West Pokot</h2>
      <ul class="community-list">
        <li><a href="communities.html?community=Lokitonyala">Lokitonyala</a></li>
        <li><a href="communities.html?community=Kasei">Kasei</a></li>
        <li><a href="communities.html?community=Alale">Alale</a></li>
      </ul>
    </div>

    <!-- ISIOLO -->
    <div class="county">
      <h2>Isiolo</h2>
      <ul class="community-list">
        <li><a href="communities.html?community=Charri">Charri</a></li>
        <li><a href="communities.html?community=Cherab">Cherab</a></li>
        <li><a href="communities.html?community=Kinna%20-%20Kulamawe%20-%20Gotu%20Dedha">Kinna - Kulamawe - Gotu Dedha</a></li>
      </ul>
    </div>

    <!-- GARISSA -->
    <div class="county">
      <h2>Garissa</h2>
      <ul class="community-list">
        <li><a href="communities.html?community=Kamuthe">Kamuthe</a></li>
      </ul>
    </div>

    <!-- SAMBURU -->
    <div class="county">
      <h2>Samburu</h2>
      <ul class="community-list">
        <li><a href="communities.html?community=Nairimirimo">Nairimirimo</a></li>
        <li><a href="communities.html?community=Arisim">Arisim</a></li>
      </ul>
    </div>

    <div id="map-container"></div>
    <div id="community-info" class="community-details"></div>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // =============================
    // Data
    // =============================
    const communityData = {
      // TURKANA
      "Lorengippi": { size: "1200 sq km", population: 5000, registeredMembers: 3780 },
      "Turkana West": { size: "1500 sq km", population: 5000, registeredMembers: 3780 },
      "Lokichar": { size: "980 sq km", population: 5000, registeredMembers: 3780 },

      // WAJIR
      "Leheley": { size: "1100 sq km", population: 5000, registeredMembers: 3780 },
      "Diff": { size: "1230 sq km", population: 5000, registeredMembers: 3780 },
      "Sabuli": { size: "1050 sq km", population: 5000, registeredMembers: 3780 },

      // MARSABIT
      "Obbu": { size: "26000 ha", population: 5000, registeredMembers: 3780 },  // coords confirmed 3.04, 38.76
      "Obittu": { size: "40000 ha", population: 6000, registeredMembers: 4000 },
      "Walda": { size: "1120 sq km", population: 5000, registeredMembers: 3780 },

      // WEST POKOT
      "Lokitonyala": { size: "950 sq km", population: 5000, registeredMembers: 3780 },
      "Kasei": { size: "1180 sq km", population: 5000, registeredMembers: 3780 },
      "Alale": { size: "1300 sq km", population: 5000, registeredMembers: 3780 },

      // ISIOLO
      "Charri": { size: "870 sq km", population: 5000, registeredMembers: 3780 },
      "Cherab": { size: "1250 sq km", population: 5000, registeredMembers: 3780 },
      "Kinna - Kulamawe - Gotu Dedha": { size: "1000 sq km", population: 5000, registeredMembers: 3780 },

      // GARISSA
      "Kamuthe": { size: "40000 ha", population: 6000, registeredMembers: 4000 },

      // SAMBURU
      "Nairimirimo": { size: "40,000 ha", population: "3,000", registeredMembers: "1647" },
      "Arisim": { size: "55,000 ha", population: "30,000", registeredMembers: "9,000" }
    };

    // Coordinates (lat, lng)
    const communityCoordinates = {
      // TURKANA
      "Lorengippi": [2.5705, 34.9889],
      "Turkana West": [3.7168, 34.9589],
      "Lokichar": [2.3810, 35.6250],

      // WAJIR
      "Leheley": [1.62759, 40.00681],
      "Diff": [1.0000, 40.9600],
      "Sabuli": [2.0883, 40.0223],

      // MARSABIT
      "Obbu": [3.04, 38.76],
      "Obittu": [2.3000, 37.9000],   // placeholder
      "Walda": [2.1310, 37.9210],

      // WEST POKOT
      "Lokitonyala": [2.36122, 34.95148],
      "Kasei": [1.97343, 35.20563],
      "Alale": [2.3439, 34.9274],

      // ISIOLO
      "Charri": [0.95833, 38.53315],
      "Cherab": [1.06729, 38.66619],
      "Kinna - Kulamawe - Gotu Dedha": [0.318539, 38.193773],

      // GARISSA
      "Kamuthe": [-0.7322, 39.8337],

      // SAMBURU
      "Nairimirimo": [1.243904, 36.974541],
      "Arisim": [1.85414, 37.13594]
    };

    // Pin colors by community (with requested updates)
    const pinColorsByName = {
      "Lorengippi": "red",
      "Turkana West": "red",
      "Lokichar": "red",

      "Leheley": "orange",
      "Diff": "orange",
      "Sabuli": "orange",

      "Obbu": "orange",
      "Obittu": "orange",
      "Walda": "orange",

      "Lokitonyala": "orange",
      "Kasei": "orange",                         // updated
      "Alale": "orange",                         // updated

      "Charri": "orange",
      "Cherab": "orange",
      "Kinna - Kulamawe - Gotu Dedha": "orange", // renamed + updated

      "Kamuthe": "green",

      "Nairimirimo": "green",
      "Arisim": "green"
    };

    // Status text (simple)
    function statusFromColor(color) {
      if (color === "green") return "‚úÖ Registered";
      if (color === "orange") return "üü† In Process";
      return "üî¥ Not registered but identified";
    }

    // =============================
    // Map setup
    // =============================
    const map = L.map('map-container', { center: [1.5, 37.5], zoom: 6 });

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Colored marker factory
    function iconFor(color) {
      const valid = ['red','orange','green'];
      const chosen = valid.includes(color) ? color : 'red';
      return new L.Icon({
        iconUrl: `https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-${chosen}.png`,
        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',
        iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34], shadowSize: [41, 41]
      });
    }

    // Add markers + popups + click wiring
    const markers = {};
    Object.entries(communityCoordinates).forEach(([name, coords]) => {
      const pinColor = pinColorsByName[name] || 'red';
      const status = statusFromColor(pinColor);
      const marker = L.marker(coords, { icon: iconFor(pinColor) }).addTo(map);

      // Rich popup (shows all details)
      const data = communityData[name] || {};
      const popupHtml = `
        <div style="width: 260px; background: #eef6fb; border: 1px solid #2BC0E4; border-radius: 8px; padding: 8px;">
          <h3 style="margin: 0 0 6px 0;">${name}</h3>
          <table style="border-collapse: collapse; width: 100%;">
            <tr>
              <th style="text-align: left; padding: 4px; border-bottom: 1px solid #2BC0E4;">Size</th>
              <td style="padding: 4px; border-bottom: 1px solid #2BC0E4;">${data.size ?? '‚Äî'}</td>
            </tr>
            <tr>
              <th style="text-align: left; padding: 4px; border-bottom: 1px solid #2BC0E4;">Population</th>
              <td style="padding: 4px; border-bottom: 1px solid #2BC0E4;">${data.population ?? '‚Äî'}</td>
            </tr>
            <tr>
              <th style="text-align: left; padding: 4px; border-bottom: 1px solid #2BC0E4;">Registered Members</th>
              <td style="padding: 4px; border-bottom: 1px solid #2BC0E4;">${
                typeof data.registeredMembers === 'number'
                  ? data.registeredMembers.toLocaleString()
                  : (data.registeredMembers ?? '‚Äî')
              }</td>
            </tr>
            <tr>
              <th style="text-align: left; padding: 4px;">Status</th>
              <td style="padding: 4px;">${status}</td>
            </tr>
          </table>
        </div>
      `;

      marker.bindPopup(popupHtml);
      marker.on('click', () => showDetails(name));
      markers[name] = marker;
    });

    // =============================
    // Details panel
    // =============================
    function showDetails(name) {
      const data = communityData[name] || {};
      const pinColor = pinColorsByName[name] || 'red';
      const status = statusFromColor(pinColor);
      const container = document.getElementById('community-info');
      container.classList.add('active');
      container.innerHTML = `
        <h3 style="margin-bottom:8px;">Details for ${name}</h3>
        <table style="border-collapse: collapse; width: 320px; background: #eef6fb; border: 1px solid #2BC0E4; border-radius: 8px;">
          <tr>
            <th style="text-align: left; padding: 8px; border-bottom: 1px solid #2BC0E4;">Size</th>
            <td style="padding: 8px; border-bottom: 1px solid #2BC0E4;">${data.size ?? '‚Äî'}</td>
          </tr>
          <tr>
            <th style="text-align: left; padding: 8px; border-bottom: 1px solid #2BC0E4;">Population</th>
            <td style="padding: 8px; border-bottom: 1px solid #2BC0E4;">${data.population ?? '‚Äî'}</td>
          </tr>
          <tr>
            <th style="text-align: left; padding: 8px; border-bottom: 1px solid #2BC0E4;">Registered Members</th>
            <td style="padding: 8px; border-bottom: 1px solid #2BC0E4;">${
              typeof data.registeredMembers === 'number'
                ? data.registeredMembers.toLocaleString()
                : (data.registeredMembers ?? '‚Äî')
            }</td>
          </tr>
          <tr>
            <th style="text-align: left; padding: 8px;">Status</th>
            <td style="padding: 8px;">${status}</td>
          </tr>
        </table>
      `;
    }

    // =============================
    // Focus helpers
    // =============================
    function focusOnCommunity(name) {
      const marker = markers[name];
      if (marker) {
        const latLng = marker.getLatLng();
        map.setView(latLng, 10, { animate: true });
        marker.openPopup();
        showDetails(name);

        // Smoothly scroll map into view so the user "moves to the map"
        const mapEl = document.getElementById('map-container');
        mapEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
      } else {
        alert('Coordinates for "' + name + '" are pending verification.');
      }
    }

    // Intercept community links so the page doesn't reload; focus on the marker instead.
    document.querySelectorAll('.community-list li a').forEach(link => {
      link.addEventListener('click', event => {
        event.preventDefault();
        // Robustly read ?community= from the link even if it's relative
        const url = new URL(link.getAttribute('href'), window.location.href);
        const community = url.searchParams.get('community') || link.textContent.trim();
        focusOnCommunity(community);
      });
    });

    // =============================
    // Handle ?community= on load
    // =============================
    (function focusFromQuery() {
      const params = new URLSearchParams(window.location.search);
      const communityParam = params.get('community');
      if (communityParam && markers[communityParam]) {
        // Slight delay ensures map has rendered before centering/opening popup
        setTimeout(() => focusOnCommunity(communityParam), 150);
      }
    })();
  </script>
</body>
</html>